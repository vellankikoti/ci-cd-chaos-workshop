# üåç Multi-Environment Deployment
**5 Minutes - The DevOps Professional's Environment Strategy**

*"In production, you don't deploy to production. You deploy to dev, then staging, then production. Each environment is a stepping stone to success."*

## üéØ **The Professional's Challenge**

**Real-world scenario:** You're managing a microservices architecture with:
- üè† **Development** - 5 developers, 50 deployments/day
- üß™ **Staging** - Production-like testing, 10 deployments/day  
- üöÄ **Production** - 10,000+ users, 1 deployment/day (when it's perfect)

**The problem:** Each environment needs different configurations, but you can't maintain 3 separate pipelines.

**Your mission:** Build one pipeline that adapts to any environment like a chameleon.

## üöÄ **Quick Start (30 seconds)**

```bash
# 1. Create Parameterized Pipeline Job
# New Item ‚Üí Pipeline ‚Üí Name: "multi-environment-deployment"
# Pipeline script from SCM ‚Üí Git
# Repository: https://github.com/vellankikoti/ci-cd-chaos-workshop.git
# Branch: */docker-test
# Script Path: Jenkins/jenkins-scenarios/scenario_02_multi_environment/Jenkinsfile

# 2. Run with Parameters
# Click "Build with Parameters"
# Select Environment: staging
# Click "Build"
```

## üé™ **The 5-Minute Masterclass**

### **Minute 1: The Parameter Strategy** ‚è±Ô∏è
**What you'll learn:** One pipeline, infinite environments

```groovy
pipeline {
    agent any
    
    parameters {
        choice(
            name: 'ENVIRONMENT',
            choices: ['dev', 'staging', 'production'],
            description: 'Target deployment environment'
        )
        choice(
            name: 'DEPLOYMENT_STRATEGY',
            choices: ['rolling', 'blue-green', 'canary'],
            description: 'Deployment strategy for this environment'
        )
        booleanParam(
            name: 'RUN_TESTS',
            defaultValue: true,
            description: 'Run automated tests'
        )
        choice(
            name: 'NOTIFICATION_CHANNEL',
            choices: ['slack', 'email', 'teams', 'none'],
            description: 'Notification channel for this deployment'
        )
    }
}
```

**üí° Pro Tip:** "Parameters are your environment chameleon. One pipeline, infinite possibilities."

### **Minute 2: Environment-Specific Configuration** ‚è±Ô∏è
**What you'll learn:** Configuration management that scales

```groovy
stage('üîß Environment Configuration') {
    steps {
        script {
            // Environment-specific configurations
            def configs = [
                'dev': [
                    replicas: 1,
                    resources: 'small',
                    database: 'dev-db',
                    monitoring: 'basic',
                    backup: false
                ],
                'staging': [
                    replicas: 2,
                    resources: 'medium', 
                    database: 'staging-db',
                    monitoring: 'enhanced',
                    backup: true
                ],
                'production': [
                    replicas: 5,
                    resources: 'large',
                    database: 'prod-db',
                    monitoring: 'full',
                    backup: true
                ]
            ]
            
            def envConfig = configs[params.ENVIRONMENT]
            echo "üîß Configuring for ${params.ENVIRONMENT}:"
            echo "  ‚Ä¢ Replicas: ${envConfig.replicas}"
            echo "  ‚Ä¢ Resources: ${envConfig.resources}"
            echo "  ‚Ä¢ Database: ${envConfig.database}"
            echo "  ‚Ä¢ Monitoring: ${envConfig.monitoring}"
        }
    }
}
```

**üí° Pro Tip:** "Configuration as code. No more environment-specific scripts scattered everywhere."

### **Minute 3: Conditional Testing Strategy** ‚è±Ô∏è
**What you'll learn:** Test what matters, when it matters

```groovy
stage('üß™ Environment-Specific Testing') {
    when {
        expression { params.RUN_TESTS == true }
    }
    steps {
        script {
            switch(params.ENVIRONMENT) {
                case 'dev':
                    echo "üß™ Development Testing:"
                    echo "  ‚Ä¢ Unit tests only"
                    echo "  ‚Ä¢ Quick smoke tests"
                    echo "  ‚Ä¢ No performance testing"
                    break
                case 'staging':
                    echo "üß™ Staging Testing:"
                    echo "  ‚Ä¢ Full test suite"
                    echo "  ‚Ä¢ Integration tests"
                    echo "  ‚Ä¢ Performance testing"
                    echo "  ‚Ä¢ Security scanning"
                    break
                case 'production':
                    echo "üß™ Production Testing:"
                    echo "  ‚Ä¢ Full test suite"
                    echo "  ‚Ä¢ Load testing"
                    echo "  ‚Ä¢ Security audit"
                    echo "  ‚Ä¢ Compliance checks"
                    break
            }
        }
    }
}
```

**üí° Pro Tip:** "Don't waste time running production tests in dev. Each environment has its purpose."

### **Minute 4: Smart Deployment Strategy** ‚è±Ô∏è
**What you'll learn:** Deploy like a pro, every time

```groovy
stage('üöÄ Smart Deployment') {
    steps {
        script {
            def deploymentStrategy = params.DEPLOYMENT_STRATEGY
            
            switch(deploymentStrategy) {
                case 'rolling':
                    echo "üîÑ Rolling Deployment:"
                    echo "  ‚Ä¢ Zero downtime"
                    echo "  ‚Ä¢ Gradual rollout"
                    echo "  ‚Ä¢ Automatic rollback on failure"
                    break
                case 'blue-green':
                    echo "üîµüü¢ Blue-Green Deployment:"
                    echo "  ‚Ä¢ Instant switchover"
                    echo "  ‚Ä¢ Full testing before switch"
                    echo "  ‚Ä¢ Quick rollback capability"
                    break
                case 'canary':
                    echo "üê¶ Canary Deployment:"
                    echo "  ‚Ä¢ 5% traffic to new version"
                    echo "  ‚Ä¢ Gradual increase based on metrics"
                    echo "  ‚Ä¢ Automatic rollback on issues"
                    break
            }
            
            // Environment-specific deployment
            switch(params.ENVIRONMENT) {
                case 'dev':
                    echo "üè† Deploying to Development:"
                    echo "  ‚Ä¢ Single instance"
                    echo "  ‚Ä¢ Basic monitoring"
                    echo "  ‚Ä¢ Auto-deploy on commit"
                    break
                case 'staging':
                    echo "üß™ Deploying to Staging:"
                    echo "  ‚Ä¢ Production-like setup"
                    echo "  ‚Ä¢ Full monitoring"
                    echo "  ‚Ä¢ Manual approval required"
                    break
                case 'production':
                    echo "üöÄ Deploying to Production:"
                    echo "  ‚Ä¢ High availability setup"
                    echo "  ‚Ä¢ Full monitoring + alerting"
                    echo "  ‚Ä¢ Multiple approvals required"
                    break
            }
        }
    }
}
```

**üí° Pro Tip:** "Different environments, different strategies. Dev needs speed, production needs safety."

### **Minute 5: Smart Notifications** ‚è±Ô∏è
**What you'll learn:** Notify the right people, at the right time

```groovy
stage('üì¢ Smart Notifications') {
    steps {
        script {
            def channel = params.NOTIFICATION_CHANNEL
            def environment = params.ENVIRONMENT
            
            switch(channel) {
                case 'slack':
                    echo "üí¨ Slack Notification:"
                    echo "  ‚Ä¢ Channel: #deployments-${environment}"
                    echo "  ‚Ä¢ Rich formatting with build status"
                    echo "  ‚Ä¢ Direct links to logs and dashboards"
                    break
                case 'email':
                    echo "üìß Email Notification:"
                    echo "  ‚Ä¢ To: devops-team@company.com"
                    echo "  ‚Ä¢ CC: ${environment}-team@company.com"
                    echo "  ‚Ä¢ Detailed deployment report"
                    break
                case 'teams':
                    echo "üì± Teams Notification:"
                    echo "  ‚Ä¢ Channel: ${environment}-deployments"
                    echo "  ‚Ä¢ Interactive cards with status"
                    echo "  ‚Ä¢ One-click access to monitoring"
                    break
            }
            
            // Environment-specific notification content
            switch(environment) {
                case 'dev':
                    echo "  ‚Ä¢ Notify: Development team only"
                    echo "  ‚Ä¢ Content: Quick status update"
                    break
                case 'staging':
                    echo "  ‚Ä¢ Notify: QA + DevOps teams"
                    echo "  ‚Ä¢ Content: Testing instructions"
                    break
                case 'production':
                    echo "  ‚Ä¢ Notify: Entire engineering team"
                    echo "  ‚Ä¢ Content: Full deployment report"
                    echo "  ‚Ä¢ Include: Performance metrics"
                    break
            }
        }
    }
}
```

**üí° Pro Tip:** "The right notification to the right people. Don't spam everyone with dev deployments."

## üéØ **What Makes This Production-Grade?**

### **üåç Multi-Environment Features:**
- ‚úÖ **Parameterized builds** - One pipeline, all environments
- ‚úÖ **Environment-specific configs** - No hardcoded values
- ‚úÖ **Conditional testing** - Test what matters, when it matters
- ‚úÖ **Smart deployment strategies** - Right strategy for each environment
- ‚úÖ **Targeted notifications** - Right people, right time
- ‚úÖ **Configuration as code** - Version controlled, auditable

### **üìä Environment Comparison:**
```
Development:
  ‚Ä¢ Deployments: 50/day
  ‚Ä¢ Testing: Basic
  ‚Ä¢ Monitoring: Minimal
  ‚Ä¢ Approval: None
  ‚Ä¢ Rollback: Automatic

Staging:
  ‚Ä¢ Deployments: 10/day
  ‚Ä¢ Testing: Full suite
  ‚Ä¢ Monitoring: Enhanced
  ‚Ä¢ Approval: Manual
  ‚Ä¢ Rollback: 2 minutes

Production:
  ‚Ä¢ Deployments: 1/day
  ‚Ä¢ Testing: Complete
  ‚Ä¢ Monitoring: Full
  ‚Ä¢ Approval: Multiple
  ‚Ä¢ Rollback: 30 seconds
```

## üö® **Real-World Production Scenarios**

### **Scenario A: The Hotfix Emergency**
*"Critical bug in production! Need to deploy fix immediately!"*

**What happens with this pipeline:**
1. **Select environment: production**
2. **Select strategy: blue-green** (safest)
3. **Skip tests: false** (always test in staging first)
4. **Notification: teams** (alert everyone)
5. **Result: Safe, fast, monitored deployment**

### **Scenario B: The Feature Rollout**
*"New feature ready for staging testing"*

**What happens with this pipeline:**
1. **Select environment: staging**
2. **Select strategy: rolling** (gradual)
3. **Run tests: true** (full validation)
4. **Notification: slack** (dev team only)
5. **Result: Thoroughly tested, ready for production**

## üéì **Key Learnings (5 Minutes)**

1. **üéõÔ∏è Parameters are powerful** - One pipeline, infinite environments
2. **üîß Configuration as code** - No more environment-specific scripts
3. **üß™ Conditional testing** - Test what matters, when it matters
4. **üöÄ Smart deployments** - Right strategy for each environment
5. **üì¢ Targeted notifications** - Right people, right time

## üöÄ **Next Level: Scenario 3**

*"Now that you can deploy anywhere, let's add security and compliance to protect your production systems..."*

---

**üí¨ The DevOps Professional's Wisdom:**
*"I've seen teams maintain 5 different pipelines for 5 environments. That's 5x the maintenance, 5x the bugs, 5x the headaches. One parameterized pipeline handles all environments. It's not just efficient - it's sanity."*

**Ready for the next challenge? Let's add security and compliance! üõ°Ô∏è**
